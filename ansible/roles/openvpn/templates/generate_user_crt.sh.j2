#!/bin/bash
source /usr/share/easy-rsa/vars

clientName=$1
# Generate Client Certificate
VAR=$(expect -c '
set easyrsa "/usr/share/easy-rsa"

spawn "$easyrsa/build-key" '$clientName'
expect -re  ".*Country.*" { send "\n" }
expect -re  ".*Province Name.*" { send "\n" }
expect -re  ".*Locality Name.*" { send "\n" }
expect -re  ".*Organization Name.*" { send "\n" }
expect -re  ".*Organizational Unit Name.*" { send "\n" }
expect -re  ".*Common Name .*" { send "\n" }
expect -re  ".*Name .*" { send "\n" }
expect -re  ".*Email.*" { send "\n" }
expect -re  ".*A challenge password.*" { send "\n" }
expect -re  ".*An optional.*" { send "\n" }
expect -re  ".*Sign the certificate.*" { send "y\n" }
expect -re  ".*commit.*" { send "y\n" }
expect eof')

# Run Expect script
echo "$VAR"
